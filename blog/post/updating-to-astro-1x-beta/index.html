<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta --><meta charset="UTF-8">
<meta name="description" content="When I originally implemented AstroJS it was on version 0.20.12, when I came back it was already in 1.0.0-beta.36. This post describes the issues and solutions in updating this little site.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="msvalidate.01" content="78F25BA9CB8A744B0E3C891CE2F772E8">
<!-- /Meta -->

<!-- Title -->
<title>Updating to AstroJS 1x beta</title>
<!-- /Title -->

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Aleo:wght@300;400&family=Fira+Code&display=swap" rel="stylesheet">
<!-- /Styles -->

<!-- Scripts -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-50373766-1"></script>

<!-- /Scripts -->

<!-- Favicons -->
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<!-- /Favicons -->
  <link rel="stylesheet" href="/_astro/intro.94f4f181.css" />
<link rel="stylesheet" href="/_astro/intro.51a0bfaa.css" /><script type="module" src="/_astro/hoisted.fda6c443.js"></script></head>
  <body>
    <div class="content-wrapper">
      <a href="#main-content" class="skip-to-content">Skip to content</a>
      <header id="top" class="main-header">
  <div class="main-header__inner wrap--xl">
    <nav class="main-nav" aria-label="Site navigation">
  <ul id="main-nav" class="js-nav main-nav__menu nav nav--inline">
    <li class="nav__item">
        <a href="/" class="nav__link">
          Home
        </a>
      </li><li class="nav__item">
        <a href="/blog" class="nav__link">
          Blog
        </a>
      </li><li class="nav__item">
        <a href="/resume" class="nav__link">
          Resume
        </a>
      </li>
  </ul>
  <ul class="secondary-nav nav nav--inline" aria-label="Contact links">
  <li class="nav__item">
      <a href="mailto:me@jmejia.com" class="nav__link" aria-label="Email link">

        <svg role="img" aria-hidden="true" class="header__icon header__icon--no-text icon" height="24" width="24">
          <use  xlink:href="#email"></use>
        </svg>
      </a>
    </li><li class="nav__item">
      <a href="https://codepen.io/mejiaj/" class="nav__link" aria-label="My codepen profile page">

        <svg role="img" aria-hidden="true" class="header__icon header__icon--no-text icon" height="24" width="24">
          <use  xlink:href="#social-codepen"></use>
        </svg>
      </a>
    </li><li class="nav__item">
      <a href="https://www.linkedin.com/in/mejiajames/en" class="nav__link" aria-label="My linkedin profile page">

        <svg role="img" aria-hidden="true" class="header__icon header__icon--no-text icon" height="24" width="24">
          <use  xlink:href="#social-linkedin"></use>
        </svg>
      </a>
    </li>
</ul>
</nav>
  </div>
</header>
      <main id="main-content">
        <div class="wrap">
          
  <h1>Updating to AstroJS 1x beta</h1>
  <time datetime="2022-06-20T00:00:00.000Z">June 20, 2022</time>
  <p>When I originally implemented <a href="https://astro.build/">AstroJS</a> on this site, it was on version <code>0.20.12</code>. Almost a year later, I wanted to update to the latest version before I started implementing bigger features.</p>
<p>Based on semantic versioning the jump from <code>0.20.12</code> to <code>1.0.0-beta.36</code> is pretty big. Thankfully, the upgrade process wasn’t too bad.</p>
<h2 id="differences">Differences</h2>
<p>Configs had changed and my site wouldn’t run after upgrading. This was a bit of a surprise, but not unexpected. I headed over to the release changelogs found my version, <a href="https://github.com/withastro/astro/blob/main/packages/astro/CHANGELOG.md#02012"><code>0.20.12</code></a>. From there I started working my way up to see if I could find anything that would help me debug.</p>
<p>Below are some changes I did to get this little site working again.</p>
<h3 id="simpler-configs">Simpler configs</h3>
<p>Configs seemed to require less, that’s great! What I didn’t realize was part of making simpler configs was breaking up stuff that was previously built in. I now needed to import <code>defineConfig</code> from <code>astro/config</code>, pass my overrides, and export that.</p>
<pre is:raw="" class="astro-code material-theme-palenight" style="background-color: #292D3E; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #A6ACCD">// astro.config.mjs</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178"> export default {</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">   …Your overrides</span></span>
<span class="line"></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D"> import { defineConfig } from "astro/config";</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D"> // https://astro.build/config</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D"> export default defineConfig({</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D">   …Your overrides</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D"> });</span></span>
<span class="line"><span style="color: #A6ACCD">};</span></span></code></pre>
<p>Sitemaps are also no longer built-in. That’s now a plugin that you need to install and load separately. That makes sense, why load something by default that you might not even use.</p>
<pre is:raw="" class="astro-code material-theme-palenight" style="background-color: #292D3E; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #89DDFF; font-style: italic">import</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">defineConfig</span><span style="color: #F07178"> </span><span style="color: #89DDFF">}</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF; font-style: italic">from</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">astro/config</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF; font-style: italic">import</span><span style="color: #A6ACCD"> sitemap </span><span style="color: #89DDFF; font-style: italic">from</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">@astrojs/sitemap</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #676E95; font-style: italic">// https://astro.build/config</span></span>
<span class="line"><span style="color: #89DDFF; font-style: italic">export</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF; font-style: italic">default</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">defineConfig</span><span style="color: #A6ACCD">(</span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #F07178">integrations</span><span style="color: #89DDFF">:</span><span style="color: #A6ACCD"> [</span><span style="color: #82AAFF">sitemap</span><span style="color: #A6ACCD">()]</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #A6ACCD">)</span><span style="color: #89DDFF">;</span></span></code></pre>
<p>This website was originally a 1-page site, so there wasn’t much to it. Here’s a full diff of changes. You can see how much was no longer needed.</p>
<pre is:raw="" class="astro-code material-theme-palenight" style="background-color: #292D3E; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #A6ACCD">// astro.config.mjs</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178"> export default {</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">  // projectRoot: '.',     // Where to resolve all URLs relative to. Useful if you have a monorepo project.</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">  pages: './src/pages', // Path to Astro components, pages, and data</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">  dist: './dist',       // When running `astro build`, path to final static output</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">  public: './public',   // A folder of static files Astro will copy to the root. Useful for favicons, images, and other files that don’t need processing.</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">  buildOptions: {</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">    site: 'https://www.jmejia.com/',  // Your public domain, e.g.: https://my-site.dev/. Used to generate sitemaps and canonical URLs.</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">    sitemap: true,      // Generate sitemap (set to "false" to disable)</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">  },</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">  devOptions: {</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">    // port: 3000,         // The port to run the dev server on.</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">    // tailwindConfig: '', // Path to tailwind.config.js if used, e.g. './tailwind.config.js'</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">  },</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">  renderers: ['@astrojs/renderer-preact'],</span></span>
<span class="line"></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D">  import { defineConfig } from "astro/config";</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D">  import sitemap from "@astrojs/sitemap";</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D">  // https://astro.build/config</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D">  export default defineConfig({</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D">    site: "https://www.jmejia.com/",</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D">    integrations: [sitemap()]</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D">  });</span></span>
<span class="line"><span style="color: #A6ACCD">};</span></span></code></pre>
<h3 id="fetching-data">Fetching data</h3>
<p>Data fetching in Portfolio examples also stopped working because that had changed as well. You now need to call an async function in <code>Astro.glob</code>, instead of <code>fetchContent</code>.</p>
<pre is:raw="" class="astro-code material-theme-palenight" style="background-color: #292D3E; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178"> const projectPreviews = Astro.fetchContent('./project/**/*.md');</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D"> const projectPreviews = await Astro.glob('./project/**/*.md');</span></span></code></pre>
<h3 id="template-changes">Template changes</h3>
<p>Once that I got rid of those initial <code>npm start</code> errors, I ran into a few more because of required template changes.</p>
<p>Using data inside of HTML elements no longer required quotes.</p>
<pre is:raw="" class="astro-code material-theme-palenight" style="background-color: #292D3E; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178"> &#x3C;a href="{ navItem.url }" class="nav__link"></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D"> &#x3C;a href={ navItem.url } class="nav__link"></span></span></code></pre>
<p>The site examples on the homepage are powered by markdown files that include basic information like the project title, my role, a brief description of the work involved, and a link to visit the site.</p>
<p>That stopped working because I now needed to reference the markdown file’s frontmatter.</p>
<pre is:raw="" class="astro-code material-theme-palenight" style="background-color: #292D3E; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178"> &#x3C;h4 class="project__title">{ project.title }&#x3C;/h4></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178"> &#x3C;ul class="project-roles h4 nav nav--inline"></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">   &#x3C;li class="nav__item project-role">{ project.role }&#x3C;/li></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178"> &#x3C;/ul></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178"> &#x3C;p></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">   { project.description }</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178"> &#x3C;/p></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178"> &#x3C;a href={ project.cta }></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178">   Visit &#x3C;span class="visually-hidden">{ project.title }&#x3C;/span> Site</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">-</span></span><span style="color: #F07178"> &#x3C;/a></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D"> &#x3C;h4 class="project__title">{ project.frontmatter.title }&#x3C;/h4></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D"> &#x3C;ul class="project-roles h4 nav nav--inline"></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D">   &#x3C;li class="nav__item project-role">{ project.frontmatter.role }&#x3C;/li></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D"> &#x3C;/ul></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D"> &#x3C;p></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D">   { project.frontmatter.description }</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D"> &#x3C;/p></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D"> &#x3C;a href={ project.frontmatter.cta }></span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D">   Visit &#x3C;span class="visually-hidden">{ project.frontmatter.title }&#x3C;/span> Site</span></span>
<span class="line"><span style="color: #89DDFF"><span style="user-select: none;">+</span></span><span style="color: #C3E88D"> &#x3C;/a></span></span></code></pre>
<p>These template updates weren’t the worst, but definitely wished for a migration guide. You can view the full list of changes in the pull request <a href="https://github.com/mejiaj/mejiaj/pull/24">Upgrade to Astro 1x beta</a>.</p>

        </div>
      </main>
    </div>
    <footer class="main-footer" role="contentinfo" id="contact">
  <nav class="nav footer-nav" aria-label="Footer menu">
    <ul class="footer-nav__menu">
      <li class="footer-nav__menu-item">
          <a href="#top" class="footer-nav__menu-link" aria-label="{ footerItem.aria_label }">
            <svg role="img" aria-hidden="true" class="footer__icon icon">
              <use  xlink:href="#up-arrow"></use>
            </svg>
              
          </a>
        </li><li class="footer-nav__menu-item">
          <a href="mailto:me@jmejia.com" class="footer-nav__menu-link" aria-label="{ footerItem.aria_label }">
            <svg role="img" aria-hidden="true" class="footer__icon icon">
              <use  xlink:href="#email"></use>
            </svg>
              Email
          </a>
        </li><li class="footer-nav__menu-item">
          <a href="https://codepen.io/mejiaj/" class="footer-nav__menu-link" aria-label="{ footerItem.aria_label }">
            <svg role="img" aria-hidden="true" class="footer__icon icon">
              <use  xlink:href="#social-codepen"></use>
            </svg>
              Codepen
          </a>
        </li><li class="footer-nav__menu-item">
          <a href="https://www.linkedin.com/in/mejiajames/en" class="footer-nav__menu-link" aria-label="{ footerItem.aria_label }">
            <svg role="img" aria-hidden="true" class="footer__icon icon">
              <use  xlink:href="#social-linkedin"></use>
            </svg>
              LinkedIn
          </a>
        </li>
    </ul>
  </nav>
</footer>

<svg width="0" height="0" class="hidden">
  <symbol version="1.1" id="email" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" xml:space="preserve" viewBox="0 0 512 512">
    <g>
      <path d="M67,148.7c11,5.8,163.8,89.1,169.5,92.1c5.7,3,11.5,4.4,20.5,4.4c9,0,14.8-1.4,20.5-4.4c5.7-3,158.5-86.3,169.5-92.1
		c4.1-2.1,11-5.9,12.5-10.2c2.6-7.6-0.2-10.5-11.3-10.5H257H65.8c-11.1,0-13.9,3-11.3,10.5C56,142.9,62.9,146.6,67,148.7z"></path>
      <path d="M455.7,153.2c-8.2,4.2-81.8,56.6-130.5,88.1l82.2,92.5c2,2,2.9,4.4,1.8,5.6c-1.2,1.1-3.8,0.5-5.9-1.4l-98.6-83.2
		c-14.9,9.6-25.4,16.2-27.2,17.2c-7.7,3.9-13.1,4.4-20.5,4.4c-7.4,0-12.8-0.5-20.5-4.4c-1.9-1-12.3-7.6-27.2-17.2l-98.6,83.2
		c-2,2-4.7,2.6-5.9,1.4c-1.2-1.1-0.3-3.6,1.7-5.6l82.1-92.5c-48.7-31.5-123.1-83.9-131.3-88.1c-8.8-4.5-9.3,0.8-9.3,4.9
		c0,4.1,0,205,0,205c0,9.3,13.7,20.9,23.5,20.9H257h185.5c9.8,0,21.5-11.7,21.5-20.9c0,0,0-201,0-205
		C464,153.9,464.6,148.7,455.7,153.2z"></path>
    </g>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="up-arrow">
    <path d="M348.3 216.4c-5 5.1-13.3 5.1-18.4.1L269 155.8v231.3c0 7.1-5.8 12.9-13 12.9s-13-5.8-13-12.9V155.8l-60.9 60.8c-5.1 5-13.3 4.9-18.4-.1-5-5.1-5-13.2.1-18.3l83-82.4c1.2-1.1 2.5-2 4.1-2.7 1.6-.7 3.3-1 5-1 3.4 0 6.6 1.3 9.1 3.7l83 82.4c5.2 4.9 5.3 13.1.3 18.2z"></path>
  </symbol>
  <symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="social-codepen">
    <path d="M12 15L22 8.5V15.5L12 22V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    <path d="M12 15L22 8.5V15.5L12 22V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    <path d="M2 15.5L12 22V15L2 8.5V15.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    <path d="M2 8.5L12 2V9L2 15.5V8.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    <path d="M12 9L22 15.5V8.5L12 2V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
  </symbol>
  <symbol version="1.1" id="social-linkedin" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" xml:space="preserve" viewBox="0 0 512 512">
    <g>
      <path d="M417.2,64H96.8C79.3,64,64,76.6,64,93.9v321.1c0,17.4,15.3,32.9,32.8,32.9h320.3c17.6,0,30.8-15.6,30.8-32.9V93.9
		C448,76.6,434.7,64,417.2,64z M183,384h-55V213h55V384z M157.4,187H157c-17.6,0-29-13.1-29-29.5c0-16.7,11.7-29.5,29.7-29.5
		c18,0,29,12.7,29.4,29.5C187.1,173.9,175.7,187,157.4,187z M384,384h-55v-93.5c0-22.4-8-37.7-27.9-37.7
		c-15.2,0-24.2,10.3-28.2,20.3c-1.5,3.6-1.9,8.5-1.9,13.5V384h-55V213h55v23.8c8-11.4,20.5-27.8,49.6-27.8
		c36.1,0,63.4,23.8,63.4,75.1V384z"></path>
    </g>
  </symbol>
</svg>
  </body></html>